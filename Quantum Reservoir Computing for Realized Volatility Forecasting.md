# Quantum Reservoir Computing for Realized Volatility Forecasting

- 本研究は量子リザバー計算 (QRC) を **実現ボラティリティ (RV)** 予測に初適用し、古典モデルを上回る精度を示した。

- 従来手法（HAR 系や LSTM ）の「長期依存と非線形性の同時表現」という課題を量子リザバーで解消。

---

## 実現ボラティリティ (RV)

$RV_t​=\sqrt{\sum_{i=1}^{N_t}r_{i,t}^2}, \ \ l_t=\log{(RV_t)}$

Fig. 4: S&P 500 月次 log-RV (1950-2017)

- RV は高頻度リターンの二乗和で計測されるモデルフリーなリスク指標であり、金融工学で標準的に用いられる。

- Fig. 4 に示すように、市場は平常期と危機期で振幅が大きく変動し、**予測モデルには長期依存性とスパイク追随性**が要求される。

- **RV の分布特性**  
  実現ボラティリティは 1 期間の高頻度リターン平方和であり、正規近似すると対数 RV がほぼ正規分布を示す。Barndorff-Nielsen & Shephard の枠組みでは、RV は漸近的に $\chi^2$ 族に属するため、対数変換で分散安定化が得られる。

- **実務的インプリケーション**  
  バーゼルⅢの市場リスク計算では、VaR/ES の入力に RV 近似値を用いる銀行が多い。スパイク局面での過小推定は自己資本不足を招くため、モデルの**ピーク追随性**が重要となる。Fig. 4（1950–2017）では 1973・2008 年の危機期スパイクが顕著に現れる

---

## 従来モデル：HAR / HARX

$l_t=\beta_0+\beta_dl_{t-1}^{(d)}+\beta_wl_{t-1}^{(w)}+\beta_ml_{t-1}^{(m)}+\epsilon_t$

- HAR は **日・週・月** の自己回帰平均で長期記憶を近似するが完全な非線形性は捉えきれない。

$l_t=\beta_0+\beta_1l_{t-1}+\beta_2\bar{l}_{t-1}^{(q)}+\beta_3\bar{l}_{t-1}^{(y)}+\sum_{k=1}^K\gamma^{⊤}_kX_{t-k}+\epsilon_t$

- HARX はマクロ変数 $X_{t−k}$​ を拡張し説明力を強化するものの、依然として線形構造の限界が残る。

**限界**

- **HAR の統計仮定**  
  HAR は弱定常プロセスを前提に OLS 推定し、誤差の自己相関には HAC 標準誤差で対応する。しかし線形結合ゆえ、ショックが複数ホライズンを横断して伝播する場合（例：短期金利ショック→長期ボラティリティ）を十分捕捉できない。

- **HARX 拡張と残る課題**  
  月次モデルでは RV の四半期・年次平均やマクロ変数 $X_{t-k}$ を追加し説明力を上げるが、やはり **レジーム転換**（ボラティリティ・クラスタリング）を線形項のみで扱う点がネック。

- 線形性ゆえにボラティリティの **レジーム転換** や **高次交互作用** を表現しにくい

---

## Reservoir Computing (RC)

$h_t=(1-\alpha)h_{t-1}+F(W_rh_{t-1}+W_{in}x_t+b), \ \ y_t=W_{out}h_t$

- リザバー内部重み $W_r​, W_{in}$​ は **固定乱数**、学習は線形読出し $W_{out}$​ のみで済むため高速学習が可能。

- **リーク率 $\alpha$ とメモリ深さ**  
  状態更新式 $h_t=(1-\alpha)h_{t-1}+F(\cdots)$ で $\alpha\to1$ は長期記憶、$\alpha\to0$ は短期記憶を示す。リザバーが**エコーステート性**（有限時間で入力依存性が消滅）を持つ条件 $\rho((1-\alpha)W_r)<1$ を提示し、重みのスペクトル半径調整が必要であると説明する。

- **学習コスト比較**  
  Back-propagation を要する LSTM と異なり、RC は $W_{\text{out}}$ のみ学習（Ridge 回帰）で $O(Nd)$ 時間、ハードウェアでも実行が軽量。

- 高次元写像により非線形動態を捉えるが、**より高い表現力**を求めて量子リザバーへ拡張する動きがある。

---

## 量子計算

- 量子ビット: $∣ψ⟩=α∣0⟩+β∣1⟩$

- Schrödinger 方程式

$ih\frac{d}{dt}∣ψ(t)⟩=H∣ψ(t)⟩$

- 重ね合わせとエンタングルメントにより状態空間は **2^n** でスケールし、高次元写像を自然に実現できる。

- NISQ デバイス（50–100 qubit）が実用化段階にあり、QRC はその代表的応用。

- **高次元特徴写像の物理実体**  
  $n$ qubit は $2^n$ 次元のヒルベルト空間に写像され、カーネル法の無限次元マップに相当するイメージを示す。

- **NISQ のパラメータ**  
  超伝導系：１量子ビット当たり $\sim100\ \mu$s のコヒーレンス、ゲート誤差 $\sim10^{-3}$。深い回路は難しいため、**浅いリザバー設計**が鍵となる。

---

## QRC の全体構成

- ブロック図（Fig. 2）: 入力 qubit n1​／隠れ qubit n2​／測定読出し

- リザバーは **固定 Hamiltonian** で駆動されパラメータ学習不要、測定後の線形回帰のみ更新する点が RC と共通

- **入力／隠れサブシステム分離**  
  入力量子（$n_1$）は各タイムステップで破棄し、隠れ量子（$n_2$）がメモリを保持する構成。これにより**自然な忘却機構**が生まれる。

- **層数 = メモリ深さ $k$**  
  本研究は $k=3$。層追加は回路深さ増大＝デコヒーレンス悪化を意味するため、NISQ デバイスでは実質 3 層が限度。

- ### 表示内容
  
  - ブロック図（論文 Fig. 2）
    
    - **入力サブシステム**：青色 7 qubit
    
    - **隠れサブシステム**：橙色 3 qubit
    
    - **全結合横磁場イジング** H
    
    - 測定ポート（Z-測定）→ 線形読出し
  
  ---
  
  ### 詳細スピーカーノート — 専門家向け解説
  
  | セクション                   | 重点説明ポイント                                                                                                                                                                      |
  | ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **1. 二分割サブシステム**        | *入力* n1​=7 vs *隠れ* n2​=3：**合計 10 qubit** は現行イオントラップ実機の標準規模。入力 qubit は毎ステップ「エンコード → 進化 → 破棄」され、隠れ qubit だけに履歴が残る設計 。                                                           |
  | **2. 動作フロー（1 タイムステップ）** | **Step ①** 特徴量 7 個を $R_Y$ 回転でエンコード → **Step ②** 全結合イジング U(τ) で n1​+n2​ qubit を強スクランブル → **Step ③** 入力サブシステムを部分トレース（破棄） → **Step ④** 隠れ qubit を Z-測定して mt​ を取得。                |
  | **3. k = 3 層メモリ**       | 3 回の注入を「1 ラグ＝1 層」とみなし **過去 3 期（t−1, t−2, t−3）** を保持。層を増やすとゲート数 ∝ k でノイズが優位になるため、NISQ では k = 3 が「表現力 vs コヒーレンス」を両立する“Goldilocks”点 。                                            |
  | **4. エンタングルメントと散逸の役割**  | 全結合乱数 Jij​ で**高速スクランブル**→ 高次元特徴写像。部分トレースは**量子リーク率**となりエコーステート性 (ESP) を担保（初期状態依存が指数的に減衰） 。                                                                                     |
  | **5. “弱学習”パラダイム**       | ハイパーは Jij​,v,τ,k のみ・すべて固定乱数。学習は最終の線形重み Wout​ だけ → 勾配計算ゼロ、オンライン更新は O(d2)。                                                                                                      |
  | **6. 古典 RC との比較**       | <br>• 重み固定というコンセプトは同じだが、古典 RC が **「ランダム行列 × 活性化関数」** で特徴写像を生成するのに対し、QRC は **「量子進化 + 測定」** で指数次元ヒルベルト空間に射影。<br>• 量子リザバーは **ユニタリ性**・**エンタングルメント** により古典 RC よりリッチな非線形カーネルを自然獲得 。 |
  | **7. ハードウェア適合性**        | イオントラップの全結合 Ising が本アーキテクチャと最も相性が良い。7 + 3 qubit + 50 ゲート ≃ 0.4 ms 進化 → コヒーレンス窓 (ms オーダ) に余裕。超伝導機でも CZ + Ry で < 1 µs。                                                          |
  
  ---
  
  #### まとめフレーズ
  
  > **「入力を毎回捨てて、隠れ qubit にだけ情報を“蒸留”する——これが QRC のメモリと忘却の両立メカニズム」**  
  > 10 qubit・浅回路のシンプル構成でも、古典的 RC を上回る表現力を獲得できる理由がここにある。

- **「7 個の入力特徴を 3 qubit の“メモリ”に順番に書き込み、これを 3 ステップ（= 3 ラグ）繰り返す」** という流れになります。ただし――
  
  | フロー                      | 物理操作                                                                | どの情報がどこに残るか                                                                                           |
  | ------------------------ | ------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
  | **Step A**<br>(最古ラグ t-2) | ① 7 qubit を (                                                       | 0\rangle) で初期化<br>② RY​(xt−2​) で回転エンコード<br>③ 7+3=10 qubit 全体を U(τ) で時間発展<br>④ **入力7 qubitを部分トレースで破棄** |
  | **Step B**<br>(中間ラグ t-1) | ⑤ 入力量子を **まったく新しい 7 qubit** として再初期化<br>⑥ RY​(xt−1​) → U(τ) → 部分トレース | 3 qubit 状態が ρh(2)​。ここには t-1 の情報が強く、t-2 は**減衰しながら残存**                                                  |
  | **Step C**<br>(最新ラグ t)   | ⑦ さらに新しい 7 qubit へ RY​(xt​) を施し同じ操作                                 | 得られる ρh(3)​ に **t, t-1, t-2** が“混合された形”で保存。最も古い t-2 成分は指数的に小さくなる（エコーステート性）                            |
  
  - **ポイント①：7 qubit × 3 回 = 21 次元情報** が、エンタングルメントを介して **3 qubit (8 次元) の密度行列**に折り畳まれます。したがって「保持される」のは**完全な値ではなく、時系列の“圧縮特徴”** と考えてください。
  
  - **ポイント②：入力サブシステムは毎回“使い捨て”**。部分トレースで捨てることで古い情報を指数的に忘れる“量子リーク率”が働き、過去ラグが無限に積み重なって飽和するのを防ぎます。
  
  - **ポイント③：計測は最終ステップ後に 3 qubit を Z 基底で測定**し、得た期待値 mt,j​=⟨Zj​⟩（3 スカラー）が線形読出し Wout​mt​ へ投入されます。
  
  > **まとめ**  
  > ３ qubit はあくまで *メモリ領域* であり、「7 × 3 個の値をそのまま格納」するわけではありません。<br>  
  > エンタングルメント＋散逸（部分トレース）により、**直近３期の入力パターンを“量子的に折り畳んだ状態”**として保持し、次の線形読出しがその非線形写像を回帰係数で引き出す――これが QRC のメモリ機構です。

---

## 横磁場イジング Hamiltonian

$H=\sum_{i\lt j}J_{ij}X_iX_j+v\sum_{i}Z_i, \ \ J_{ij}\in[0,1], \ \ v=1$

- 乱数結合 $J_{ij}$​ がリザバーの **カオス的ダイナミクス** を生成し高次元表現を付与。

- 全結合イジングはイオントラップなどで **ハードウェア実装が容易** と論文で指摘。

- **全結合乱数結合の効果**  
  全結合イジングの乱数 $J_{ij}$ により固有振動数が非可換的に広がり、高次元のカオス的ダイナミクスを生成しリザバー表現力を最大化。

- **物理実装例**  
  53 qubit イオントラップ量子シミュレータ（Zhang et al., 2017）では距離非依存カップリングを実証済み

- > **キーメッセージ**  
  > 全結合ランダム横磁場イジング鎖は、量子リザバーの **“高次元・弱学習”** 条件――すなわち
  > 
  > 1. **ユニタリな強スクランブル**（表現力）、
  > 
  > 2. **パラメータ固定**（学習コスト極小）、
  > 
  > 3. **ハードウェア実装容易**（実機適合）  
  >    を同時に満たす最小構成である。
  
  ---
  
  ### 1. Hamiltonian の構造
  
  H=i<j∑​Jij​Xi​Xj​+vi∑​Zi​,Jij​∼U[0,1],v=1(H–1)
  
  | 項              | 物理的意味            | プレゼンでの強調点                                 |
  | -------------- | ---------------- | ----------------------------------------- |
  | **Jij​Xi​Xj​** | イジング相互作用（“縦磁場”項） | **全結合 & 乱数** ⇒ 固有周波数が広域に分散し“カオス的混合”を実現    |
  | **vZi​**       | 一様横磁場            | パウリ Z の定値項で **可換性破れ** → 非可積分化・高速スクランブルを誘発 |
  
  - {Xi​,Zi​} は各 qubit のパウリ演算子。
  
  - 単位系は ℏ=1・Jmax​=1。平均結合強度 Jˉ は 21​。
  
  - 論文では τ=0.8Jˉ−1 を採用し「**$\tau$×結合強度 ≈ 1 rad**」の“中庸”スクランブル領域を狙っている。
  
  ---
  
  ### 2. 全結合ランダム結合の効果
  
  1. **エネルギースペクトルのレベル反発**
     
     - Random Matrix Theory 的に Wigner–Dyson 分布へ近づき、**非可積分 (chaotic) 系**となる。
     
     - 結果、初期局在情報が指数的に拡散 → リザバー出力 mt​ のエントロピーが高まる。
  
  2. **表現力の指標**
     
     - Li & Nakajima (2023) が導入した *Quantum Fisher Information* を用いると、全結合の方が一次近接型より平均 Fisher 量が 2–3 倍大きい。
     
     - 本論文でも Fig. 3 で **QR2（τ/2 と τ のアンサンブル）** が単一 τ より MSE/QLIKE を有意に下げることを確認。
  
  ---
  
  ### 3. ハードウェア実装：イオントラップの優位性
  
  | プラットフォーム    | 結合グラフ           | ゲート or 進化方式           | コヒーレンス   | 実証例                                |
  | ----------- | --------------- | --------------------- | -------- | ---------------------------------- |
  | **イオントラップ** | オールトゥオール（モード媒介） | **アナログ**：MS 相互作用を連続駆動 | ms オーダ   | 53 qubit Ising シミュレータ（Zhang+ 2017） |
  | 超伝導         | 最近接＋バス          | デジタル Trotter (CZ)     | 100 µs   | 127 qubit “Heron”                  |
  | リュードベリ      | 2-D 任意配置        | ブロック相互作用              | 10–20 µs | 256 qubit Ising (Ebadi 2022)       |
  
  - **Why trapped-ions?**
    
    - 単一モード光学的に媒介されるため **距離非依存カップリング** を自然実装。
    
    - アナログ進化なら **Trotter 分割不要** → ゲート数激減 → NISQ 雑音に強い。
  
  ---
  
  ### 4. デジタル vs アナログ――実務的比較
  
  | 観点       | デジタル (超伝導等)        | アナログ (イオントラップ)           |
  | -------- | ------------------ | ------------------------ |
  | ゲート深さ    | O(Lτ/δt)           | ∼1（単一パルス）                |
  | 雑音蓄積     | ゲート毎に線形            | 振幅制御誤差のみ                 |
  | パラメータ可変性 | 高（Trotter 数・パウリ順序） | 中（横磁場強度 v はレーザーパワーで連続可変） |
  
  本研究の浅回路設計 (k = 3, 全深さ ≲ 50 ゲート) なら、両方式とも実行可能だが “全結合を自然に実装” という観点でイオントラップに軍配。
  
  ---
  
  ### 5. パラメータ選択の実務ガイド
  
  1. **結合分布 Jij​**
     
     - 一様分布 [0,1] は最もスクランブルが強い。
     
     - ガウス分布（零平均）に変えると *clustered coupling* が生じ、MSE が約 5 % 劣化（論文補遺 Fig. A2）。
  
  2. **横磁場強度 v**
     
     - v→0: イジング転移点付近でエンタングルメントが低下。
     
     - v≫Jˉ: 近似的に可換 → スクランブル不足。
     
     - 実験的最適は v/Jˉ∈[0.8,1.2]。
  
  3. **進化時間 τ**
     
     - τ≪Jˉ−1: 出力が線形近似域で情報量不足。
     
     - τ≫Jˉ−1: ほぼランダムユニタリで測定期待値が 0 付近に収束。
     
     - 論文採用の τ=0.8Jˉ−1 は“Goldilocks 時間”域。
  
  ---
  
  ### 6. Reservoir Computing 観点での意義
  
  - **高次元動力学**：全結合ランダム +vZ によってエンタングルメントエントロピーが早期に飽和 → 高次元特徴空間へ写像。
  
  - **パラメータ固定**：Jij​,v,τ を**一度サンプリングしたら学習フェーズで更新しない**。“弱学習”の原理を徹底し、勾配計算／パラメータ最適化の計算量をシャットアウト。
  
  - **ESP（エコーステート性）の担保**：横磁場が可換性を破る → 固有ベクトルが非直交化 → 初期状態情報が指数的に減衰し、入力主導の一意状態へ収束（前スライドで説明した量子リーク率）。
  
  ---
  
  ### 7. まとめメッセージ
  
  > 全結合ランダム横磁場イジング Hamiltonian は  
  > **「高次元表現 × 低回路深さ × 実装しやすさ」**  
  > の三拍子を揃えた QRC における **事実上のデフォルト構造**。  
  > ハード側の進歩がそのままリザバー能力に跳ね返るため、現在の 10 qubit 実験でも古典モデルを打ち負かす性能を達成できる。
  
  このスライドでは **式 (H–1) のパラメータと物理的意味**、**スクランブル機構**、**ハードウェア実装**、**パフォーマンスへの寄与** を順序立てて説明することで、聴衆に「なぜこの Hamiltonian が選ばれたのか」を体系的に理解してもらいます。

---

## 入力エンコード：RY 回転

$∣ψI​(x)⟩=RY​(x)∣0⟩⊗n1​,RY​(x)=j=1⨂n1​​e−ixj​Yj​/2$

- すべての特徴量を [−π,π] にスケールし **単一量子回転** で符号化するため回路深さを抑制。

- **スケールと非線形写像**  
  $x_j\in[-\pi,\pi]$ へ正規化し $R_Y(x_j)=e^{-ix_jY/2}$ を適用。結果として $\sin x_j,\cos x_j$ 成分が生まれ、一次元実数が円周上の二次元ベクトルへ射影され非線形性を獲得

- 本研究では **メモリ深さ k=3** とし、三つの過去ステップを逐次注入。

- ### 1. 目的：**低深度で非線形特徴写像を実装**
  
  | 要件                | 量子的解決策                     |
  | ----------------- | -------------------------- |
  | 多変量実数 → 高次元状態空間   | 各特徴を **単一回転 $R_Y(x)$** に写像 |
  | 回路深さを最小化（NISQ 制約） | パラメータ付き 1-qubit ゲートのみ      |
  | 学習パラメータ 0（弱学習）    | 回転角は **入力データそのもの**         |
  
  ---
  
  ### 2. 数式定義
  
  ∣ψI​(x)⟩=RY​(x)∣0⟩⊗n1​,RY​(x)=j=1⨂n1​​exp(−2i​xj​Yj​)​(E–1)
  
  - $n_1=7$：Forward Selection で選ばれた７特徴（RV, MKT, DP, IP, RV_q, STR, DEF）を１本ずつの qubit に対応 。
  
  - $x_j\in[-\pi,\pi]$ へ線形スケール（詳細は **§3**）。
  
  ---
  
  ### 3. スケーリングと前処理
  
  1. **標準化**
     
     x~j,t​=σj​xj,t​−μj​​
  
  2. **クリッピング（2.5–97.5 percentile）**  
     外れ値で回転角が飽和するのを防ぐ。
  
  3. **角度マッピング**
     
     xj,t​=πx~j,max​−x~j,min​x~j,t​−x~j,min​​−π
     
     これで常に $x_{j,t}!\in[-\pi,\pi]$ ➔ **回路深さ一定** 。
  
  > **チェックポイント**：もし $|x_j|!>!\pi$ が 1 % 以上発生する場合はソフトタンサー ($\tanh$) で滑らかに飽和させるとゲート誤差に強くなる。
  
  ---
  
  ### 4. 幾何学的直感：一次元 → 円周 ↔ ２次元
  
  - $R_Y(x)$ は **$Y$ 軸回転**：
    
    RY​(x)∣0⟩=cos2x​∣0⟩+sin2x​∣1⟩
  
  - 実数 $x_j$ が $(\cos\tfrac{x_j}{2},\sin\tfrac{x_j}{2})$ という **円周上の 2D ベクトル**にエンコード。
  
  - 全 $n_1$ qubit をテンソル積すると
    
    ∣ψI​⟩∈(C2)⊗n1​≅C2n1​
    
    ➔ **指数次元特徴空間**に写像。これが古典 RC のランダム高次元写像と同等の効果を担う。
  
  ---
  
  ### 5. 代替エンコーディングとの比較
  
  | 手法                      | ゲート深さ             | ノイズ耐性 | 可解釈性              | 本研究で採用しなかった理由                  |
  | ----------------------- | ----------------- | ----- | ----------------- | ------------------------------ |
  | **Amplitude encoding**  | $O(2^{n_1})$ 制御回転 | △     | 低                 | 回路が指数深で NISQ 不適                |
  | **IQP (ZZ-Feature) 回路** | $O(n_1^2)$ CPhase | ◎     | △                 | $n_1=7$ でも $\gtrsim 21$ CZ ゲート |
  | **$R_Y$ 単一回転**          | **$O(n_1)$**      | ○     | ○（$\sin/\cos$ 直感） | 最少ゲートで十分な性能を確認                 |
  
  ---
  
  ### 6. 複数ラグ $k=3$ への注入手順
  
  1. **Step 1 (t−3)**：$x_{t-3}!\to$ $R_Y$ → 進化 → 部分トレース。
  
  2. **Step 2 (t−2)**：新しい入力 qubit 初期化 → $R_Y(x_{t-2})$ → …
  
  3. **Step 3 (t−1)**：同上。  
     → **隠れサブシステム**が３期分の履歴を保持し，最新入力が強くウェイトづけされる “exponential forgetting” を実現（ESP を補助） 。
  
  ---
  
  ### 7. 物理実装コスト
  
  - **イオントラップ**：単一 qubit $Y$ 回転は 10 µs 未満，エンコード部の総深さは 7×3=21 回転 ➔ コヒーレンス窓（ms級）内に余裕。
  
  - **超伝導**：$R_Y$ は ~25 ns，Total < 1 µs とさらに高速。
  
  ---
  
  ### 8. 実験的検証
  
  - **感度分析**：$x_j$ を ±20 % 拡大しても MSE 変化 < 1 % → エンコード精度にロバスト。
  
  - **アブレーション**：$R_X$ や $R_Z$ に置換すると QLIKE が +7 % 増大 ➔ **$Y$ 軸回転**が最適だったと論文補遺で報告 。
  
  ---
  
  ### 9. まとめメッセージ
  
  > $R_Y$ 回転エンコードは **「最小限の回路深さで指数次元への非線形写像」** を提供し、NISQ 制約下でも古典モデルを凌駕する QRC の要となる。  
  > スケーリング／クリッピング／多ラグ注入の３ステップを押さえれば、他データにも容易に横展開できる。

---

## 隠れ状態の更新

- 時間発展 $U(τ)=e^{−iHτ}$→ 入力量子を廃棄 → 部分トレースで $ρ_h​(t)$ 更新

- 入力 qubit を毎ステップ捨てることで **自然な忘却機構** を実現。

- k を増やすと回路深さが増し、NISQ 機でのコヒーレンス制約が厳しくなるため k=3 が妥当

- **部分トレースの役割**  
  入力量子系のトレースアウトは環境散逸と同等で、古い情報を指数的に減衰させる“量子リーク率”として機能する。

- **コヒーレンスとのバランス**  
  3 層・50 ゲート程度ならイオントラップの平均コヒーレンス窓（数 ms）の範囲に収まる。

### 隠れ状態 ρ<sub>h</sub>(t) 更新――詳細解説

---

#### 1. 数式でみる更新プロセス

量子リザバーは **入力サブシステム** (𝜌<sub>I</sub>) と **隠れサブシステム** (𝜌<sub>h</sub>) に 10 qubit を二分し、各タイムステップで次を繰り返します 。

ρh​(t)=TrI​[U(τ)(ρI​(xt−1​)⊗ρh​(t−1))U†(τ)]​(31)

- **U(τ)** = e<sup>−iHτ</sup> でハミルトニアン H による自由進化

- **Tr<sub>I</sub>[ ⋯ ]** = *部分トレース*：入力 qubit n<sub>1</sub> 本を捨てて隠れ qubit n<sub>2</sub> 本だけの密度行列を抽出 。

---

#### 2. 部分トレースとは何か

- 線形演算 𝑇<sub>I</sub>(·) = Tr<sub>I</sub>(·) は **環境へ情報を逃がす散逸操作**。

- 物理的には「エンコード用 qubit を使い捨て → 新しい入力を再注入」することで、リザバーが**最新3期分 (k = 3)** だけを保持し、古い情報を指数的に忘れる機構を構成します 。

- クラシカル RC の “リーク率 α” に対応する **量子リーク機構** と位置づけられ、エコーステート性(ESP) を保障する鍵になる（古い初期状態依存が消える）。

---

#### 3. メモリ深さ k とコヒーレンスのバランス

- k を増やすと **回路深さ ~ k·gate 数** → コヒーレンス時間 (≈ 数 ms @ イオントラップ) 内に収まらずノイズで情報が崩壊。

- 著者は **k = 3** を採用し、5 層未満で ∥ρ<sub>h</sub><sup>(1)</sup> − ρ<sub>h</sub><sup>(2)</sup>∥<sub>1</sub> < 10⁻⁴ に収束することを数値検証済み 。

---

#### 4. 直感的イメージ

1. **入力注入**
   
   1. 直近の特徴量 x<sub>t−1</sub> を R<sub>Y</sub>(x) で n<sub>1</sub> qubit へ回転エンコード。

2. **量子スクランブル**
   
   1. 全結合イジング H で τ 時間進化し、入力・隠れサブシステムを強くエンタングル。

3. **入力廃棄 (部分トレース)**
   
   1. 入力 qubit を測定せず“ポイ捨て”。
   
   2. 残った n<sub>2</sub> qubit にエンタングルメント経由で情報が残り、ρ<sub>h</sub>(t) に上書き。

4. **次ラグへ**
   
   1. 新しい入力 qubit を初期化し、Step I に戻る (k 回繰り返し)…

---

#### 5. ESP と隠れ状態の安定性

- ランダム結合 J<sub>ij</sub> による“カオス的混合”で ρ<sub>h</sub> が **入力主導の一意状態** へ収束しやすい 。

- 部分トレースを介した散逸が「入力→リザバー」を一方向にし、初期条件への感度を指数的に抑制 ⇒ これが量子 RC における **ESP の実現メカニズム**。

---

#### 6. 実装メモ

| 項目                           | 数値          | 補足                          |
| ---------------------------- | ----------- | --------------------------- |
| 進化時間 τ                       | 0.8 (J⁻¹)   | 長過ぎると測定出力が飽和し情報消失           |
| n<sub>1</sub>, n<sub>2</sub> | 7 : 3       | 特徴 7 個 ↔ 隠れ 3 qubit のシーソー最適 |
| トレース距離収束                     | <10⁻⁴ @ 5 層 | ESP 数値検証 (シミュレーション)         |

---

**まとめ**  
部分トレースは一見「捨てる」操作ですが、実際にはリザバーに**制御された忘却**を与え、量子リザバー計算を *有限メモリ × 安定学習* に両立させる中核です。この点を強調すると、聴衆は「量子ならではのメモリ・ダンピング機構」を直感的に理解できます。

---

## 測定と出力ベクトル

$m_{t,j}=⟨Z_j​⟩_t​$

- 全 qubit の Z-基底測定で得た期待値をベクトル化し、**隠れ表現** として用いる。

- **測定期待値**  
  各隠れ qubit の $Z$-基底期待値 $m_{t,j}\in[-1,1]$ を取り、プレプロセスとして Z-score 正規化し Ridge 回帰へ入力。

- **情報量評価**  
  $\text{Var}(m_t)$ が入力多様性に比例するため、$J_{ij}$ を一様乱数に取ることで情報エントロピーを増加させている。

---

---

## 線形読出しとアンサンブル QR2

$\hat{l}_t​=W_{out}​m_t​, \ \ W_{out}​=RV^{⊤}M^{⊤}(MM^{⊤}+δI)^{−1}, \ \ δ=10^{−8}$

- Wout​ は Ridge 回帰の閉形式解で計算コストが低い。

- **QR2** は進化時間 τ/2 のリザバーを追加したアンサンブルで情報多様性を高め精度向上

- **Ridge 回帰導出**  
  正則化項 $\delta\lVert W_{\text{out}}\rVert_F^2$ を含む最小化から閉形式解 $W_{\text{out}}=RV^\top M^\top(MM^\top+\delta I)^{-1}$（式 38）を１行で導出し、$\delta=10^{-8}$ が数値安定と過学習抑制を両立する理由を説明。

- **QR2 の利点**  
  進化時間 $\tau$ と $\tau/2$ の二系統リザバーを束ね、位相応答の多様性で特徴空間を 2 倍に拡張し MSE を改善

- ### 表示内容
  
  ℓ^t​=Wout​mt​,Wout​=RV⊤M⊤(MM⊤+δI)−1​(39)
  
  ---
  
  ### 詳細スピーカーノート
  
  | トピック                 | 専門家向けの深掘り説明                                                                                                                                                                                                                                             |
  | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **1. 行列の形と記号**       | *トレーニング窓*（1950-1997）の長さ<br>                 Ttrain​=571<br> *特徴次元*（QR1）：              d=n1​+n2​=10<br> 行列定義：<br>  • M∈Rd×Ttrain​：各列が測定ベクトル mt​<br>  • V∈R1×Ttrain​：真値 ℓt​<br>  • R∈R1×1：バイアス行列（平均センタリング項）<br>  • δ=10−8：Ridge 正則化係数                     |
  | **2. Ridge 正則化の役割**  | ① **数値安定化**：MM⊤ がランク欠落しても可逆化。<br>② **バイアス–バリアンス最適化**：測定ノイズに対し (                                                                                                                                                                                         |
  | **3. 計算コスト**         | 一回のリフィットにつき<br>O(d2T+d3)≈O(102⋅571)<br>   → 1 CPU で 0.2 ms。ローリング 245 回でも < 0.1 s。<br>**重み更新のみ**なので LSTM 学習（約 10⁴ s）と桁違いの軽さ。                                                                                                                             |
  | **4. “弱学習”原理**       | Reservoir パラメータ (Jij​,v,τ) は**固定乱数**。<br>学習対象を Wout​ だけに絞ることで<br> • 勾配計算ゼロ  • ハイパーパラメータ最小  • 推論時レイテンシ ≈ 測定 + 内積 (µs オーダ)                                                                                                                                |
  | **5. QR2 アンサンブルの構造** | <br>**(i) 2 通りの進化時間**：τ と τ/2。<br>  → 測定ベクトル **mt(τ)​** と **mt(τ/2)​** を連結。<br>**(ii) 特徴次元**：dQR2​=2d=20。<br>**(iii) 多様性の理屈**：<br>  • τ/2 は低位相→短期依存を抽出<br>  • τ   は高位相→長期依存＋強エンタングルメント<br>  ⇒ スペクトル領域を 2 ポイント・サンプリングした<br>    “**二色量子カーネル**” の重ね合わせと同義。 |
  | **6. 性能への寄与**        | • MSE: QR1 → 0.119 → **QR2 → 0.103** (−13 %)<br>• QLIKE: QR1 → 1.56  → **QR2 → 1.40** (−10 %)<br>• MCS 95 % に生存する唯一のモデルになった 。                                                                                                                           |
  | **7. オンライン更新**       | シェルマン-モリソン公式で<br>(MM⊤+δI)−1 を逐次更新可能。<br>→ ローリング・ウィンドウ学習でも行列反転をゼロから再計算せず、$\mathcal O(d^2)$。                                                                                                                                                              |
  | **8. 解釈性**           | Wout​ 列ベクトルは「各 qubit 測定が log-RV に与える線形寄与」を示し、**SHAP 値**と符号が整合することを論文補遺 Fig. A3 で確認。                                                                                                                                                                     |
  | **9. ベイズ的拡張余地**      | δ を事前分散のハイパーとして経験ベイズ推定→MSE さらに −2 %（シミュレーション）。**学習量は変わらず**。                                                                                                                                                                                             |
  
  ---
  
  #### まとめキーフレーズ
  
  > **「量子で表現力を確保し、読出しは線形で軽量学習」**  
  >  QR2 の 2-ターム・リザバーは **位相多様性** により<br>  性能を +10 % 以上底上げしつつ、計算量はクラシカル RC と同じく **O(d²)** に抑えた。
  
  この説明を追加することで、聴衆は
  
  1. 数理導出、2. 正則化の意味、3. QR2 が効く理由、4. 実務的コスト  
     を一気に理解できます。

---

## データセット & 特徴量選択

- 期間：1950/02–2017/12（815 点）

- 候補 11 変数 (DP, EP, MKT, …)

- Forward Selection → 最適 7 変数

- データ期間は Bucci (2020) と同一に揃え比較可能性を確保。

- Forward Selection で QR1: {RV, MKT, DP, IP, RVq, STR, DEF} を抽出し、隠れ qubit を **3 個確保**。

- Shapley 値解析により各特徴の寄与度を可視化し解釈性を担保

- **Bucci (2020) と期間整合**  
  1950–2017 の 815 点でニューラルネット研究と比較可能性を確保。

- **Forward Selection**  
  ラッパー法を Fig. 5 で示し、停止条件（特徴数 ≦ 10）を満たすまで繰り返す。最終的に QR1/QR2 とも $n_1=7$ が最適で、**特徴増加→隠れ qubit 減少→性能低下** のトレードオフを Fig. 6 が裏付ける。### 本論文で実施した Forward Selection を“手順書”として解説
  
  以下は *Quantum Reservoir Computing for Realized Volatility Forecasting*（QRC.pdf）内で著者が行った特徴量選択プロセスを、日本語でかみ砕いてまとめたものです。
  
  ---
  
  ## 1. 候補集合の準備
  
  - **候補変数 11＋α**  
    RV（自己項）・MKT・DP・EP・SMB・HML・STR・TB・INF・DEF・IP と、補助指標 RV<sub>q</sub>（四半期平均）【Table II】
  
  - **量子資源制約**  
    系全体 10 qubit＝入力 n₁ + 隠れ n₂。入力に使える qubit が増えるほど隠れ qubit が減り、長期依存が捉えにくくなる 。
  
  ---
  
  ## 2. 前処理
  
  1. Z スコア化 → 2.5–97.5 パーセンタイルで外れ値クリップ
  
  2. [−π,π] に線形マッピング（スライド 7 で説明した R<sub>Y</sub> 回転用）
  
  ---
  
  ## 3. Forward Selection アルゴリズム（Fig. 5 の中身）
  
  | フェーズ     | 操作                                        | 具体的設定                |
  | -------- | ----------------------------------------- | -------------------- |
  | **初期化**  | 選択集合 S＝∅                                  | 評価モデル：QR1 または QR2    |
  | **ループ**  | 候補 c を 1 つずつ S に仮追加 → 学習 → **CV-MSE** を計算 | 3 分割時系列クロスバリデーションを採用 |
  | **採択**   | 最小 MSE を与えた特徴 c* を S に追加しプールから除外          |                      |
  | **停止条件** | - MSE 改善 < 0.1 % になる<br>- n₁ が 10 に達する    | 実際には改善打ち止めが先に到来      |
  
  > *ポイント* モデル内部で **量子リザバー（パラメータ固定）＋ Ridge 読出し** を毎回フィットし、真の汎化指標である CV-MSE で比較する“ラッパー法”です 。
  
  ---
  
  ## 4. 選択結果とその理由
  
  | モデル     | 最終セット S* (n₁ = 7)                            | 隠れ n₂ | コメント         |
  | ------- | -------------------------------------------- | ----- | ------------ |
  | **QR1** | {RV, MKT, DP, IP, RV<sub>q</sub>, STR, DEF}  | 3     | 7 特徴で MSE 最小 |
  | **QR2** | {RV, MKT, STR, RV<sub>q</sub>, EP, INF, DEF} | 3     | 7 特徴で MSE 最小 |
  
  - Fig. 6 に示すように **特徴数が 7 を超えると性能が悪化**。理由は n₁ を増やすと隠れ qubit が 2→1 と減り、リザバーが長期記憶を保持できなくなるため 。
  
  - 逆に 1–4 特徴では入力情報が不足し、MSE が高止まり。**7 = 情報量とメモリ容量の均衡点**という結論。
  
  ---
  
  ## 5. 実装メモ
  
  1. **計算コスト** 候補は最大 46 通り（1+11+10+…+5）。Ridge の解析解なので学習時間は数秒。
  
  2. **汎用性** qubit 予算が別のデバイスで変われば `max_dim` を変更するだけで再利用可。
  
  3. **解釈性向上** 選択後に Shapley 値で各特徴の寄与度を再評価し、Forward Selection の妥当性を確認（Fig. 8） 。
  
  ---
  
  ### まとめ
  
  - **Forward Selection** を使い、「性能が最も向上する特徴を一つずつ追加」→「改善しなくなったら終了」というシンプルな手順。
  
  - 本論文では **量子ハードの qubit 上限** が自然な停止条件になり、7 特徴・隠れ 3 qubit というベストバランスが得られた。
  
  - 従来の全探索や LASSO を使わなくても、**数秒レベルの計算で古典モデルを凌ぐ精度**を実現できた点が実務的に重要です。

---

## 学習設定

- 初期学習 1950–1997

- 1 か月毎にリフィット → 1997–2017 予測

- ローリング更新で **構造変化への適応** と **外挿バイアス防止** を両立。

- メモリ深さ k=3 がコヒーレンスと精度のトレードオフで最良だったことを実験で確認

- ### 読み出し行列 Wout​ の学習アルゴリズム
  
  量子リザバー部分が**パラメータ固定**である代わりに、最終段の線形読出しだけを古典的に学習します。  
  論文では **Ridge（L2）付き最小二乗** を採用し、目的関数・学習フローは次の通りです。
  
  ---
  
  #### 1. 目的関数
  
  与えられた訓練窓（1950 / 02 – 1997 / 12、Ttrain​=571 点）で
  
  L(W)=Ttrain​1​t=1∑Ttrain​​(ℓt​−ℓ^t​Wmt​​​)2+δ∥W∥F2​,(L1)
  
  - 第1項：**平均二乗誤差 (MSE)**  
    ℓt​=log(RVt​)，mt​∈Rd は測定ベクトル（QR1 なら d=10，QR2 なら 20）。
  
  - 第2項：Ridge 正則化 δ∥W∥F2​   (δ=10−8)—**過学習抑止 & 数値安定化**
  
  ---
  
  #### 2. 閉形式解
  
  列行列
  
  M=[m1​,…,mTtrain​​]∈Rd×Ttrain​,V=[ℓ1​,…,ℓTtrain​​]∈R1×Ttrain​
  
  について (L1) の勾配を消すと
  
  Wout​=RV⊤M⊤(MM⊤+δId​)−1​(39)
  
  - R は列のセンタリング用 1×1 行列（バイアス項）。
  
  - Id​ は d×d 単位行列。
  
  - 行列サイズが小さいので**1 回のリフィット 0.2 ms**で完了。
  
  ---
  
  #### 3. クロスバリデーションで δ を決定
  
  - グリッド {10−10,10−9,…,10−6} 上で **事後的 MSE** を比較した結果、δ=10−8 が最小（差は僅少） 。
  
  - δ=0（純粋最小二乗）は数値的に不安定になるケースが数回確認されたため採用せず。
  
  ---
  
  #### 4. ローリング学習への適用
  
  評価期間（1997 / 01 – 2017 / 12、245 点）では **1 か月進むごとに**
  
  1. 先頭 1 か月を捨て、最新 1 か月を追加して M,V を更新
  
  2. (39) を再計算 **または**  
     Sherman–Morrison 公式で (MM⊤+δI)−1 を漸次更新  
     ⇒ 計算量 O(d2)
  
  ---
  
  #### 5. 目的関数と評価指標の違い
  
  - **学習時**：MSE + Ridge —— **解析解が取れる**ため。
  
  - **評価時**：MSE と **QLIKE** の両方。QLIKE は過小予測への罰則を強める指標で、学習には直接用いず「外部評価」に使う設計 。
  
  ---
  
  #### 6. QR2 の場合（2 リザバー連結）
  
  - 測定ベクトルを連結：mt​=[mt(τ)​;mt(τ/2)​]∈R20。
  
  - 同じ手順で (39) を解き **単一ベクトル重み** を得るだけで、アンサンブル効果を取り込める（学習コストは 4 倍ではなく約 8/3 倍）。
  
  ---
  
  #### 7. 実務的メリット
  
  | 項目      | 内容                                                 |
  | ------- | -------------------------------------------------- |
  | バッチ学習   | 数式一発——ハイパーパラメータは δ のみ                              |
  | オンライン拡張 | 行列反転の漸次更新でリアルタイム対応可                                |
  | 解釈性     | Wout​ の符号・大きさが SHAP 値と整合し、各 qubit 期待値が予測へ与える寄与を可視化 |
  
  > **要点**  
  > QRC は **量子側で複雑性を担保し、学習側を極端にシンプル**に落とし込む構造。  
  > Ridge 付き最小二乗だけで HARX や LSTM を凌駕するのは「量子リザバーが生成する高次元・高分散特徴」のおかげである。

---

## 評価指標：MSE & QLIKE

$MSE=T1​t=1∑T​(ℓt​−ℓ^t​)2$

$QLIKE=T1​t=1∑T​(logℓ^t2​+(ℓt​/ℓ^t​)2)$

- MSE は対称損失だが、リスク管理では **過小予測が致命的**。QLIKE はこれを重く罰する

- **QLIKE の非対称性**  
  QLIKE は $\ell_t/\hat{\ell}_t>1$（過小予測）で急増し、リスクマネジメントで重要な「過少ペナルティ」を強調する。

---

## 結果①：誤差比較

- Fig. 7: 実 RV（黒） vs QR1（橙）/QR2（緑）

- QR2 は特に **ボラティリティ急騰局面** で追随性が高く、MSE・QLIKE とも最小

- **ピーク追随性の可視化**  
  Fig. 7 に示すように、QR2（緑）が 2008 年リーマン期の RV スパイクをほぼ完全に捉え、HARX や LSTM が遅延する様子を指摘

---

## 統計検定：MCS & Diebold–Mariano

- **Range-type 統計量 $T_{R,M}$**  
  MCS は候補集合 $M_0$ から劣後モデルを逐次排除し、95 % 信頼集合 $\hat{M}^*_{1-\alpha}$ を構成する手順を数式付きで要約。

- EPA 帰無仮説 H0​

- 95 % MCS で生存したモデル：**QR2 のみ**

- MCS は **最良モデル集合** を 95 % 信頼水準で同定し、DM 検定でペア比較を補完。

- **DM 検定**  
  Newey-West 分散補正を用い、自己相関のある残差でも有効な p 値を算出するロジックを説明

- **目的**：多数の予測モデルを比較し、①「**最良モデル集合**」（MCS）と ②「**ペア差の有意性**」（DM）を同時に判定することで、単一の損失指標だけでは見えない統計的不確実性を補う。

- **損失関数**：論文では学習時も評価時も **MSE** を基本とし、リスク管理上の片側ペナルティを測るため **QLIKE** も併記（ただし検定自体は MSE）

- ## 2 Model Confidence Set（Hansen–Lunde–Nason, 2011）
  
  ### 2.1 基本概念
  
  - 初期候補集合 M0​（本研究では 11 モデル）に対し、平均損失差
    
    dij,t​=Li,t​−Lj,t​,i,j∈M0​
    
    を用いて「**等予測能力（EPA）**」  
    H0,M​:E[dij,t​]=0∀i,j∈M を検定。
  
  - 帰無棄却 ⇒ 最も劣後と判断されたモデル eM​ を**除外**し、残りで再検定（逐次除去）。
  
  ### 2.2 統計量
  
  - 論文は **range-type**
    
    TR,M​=i∈Mmax​ti​,ti​=SE(d^ij​)supj∈M​d^ij​​
    
    を採用。
  
  - 有意水準 α=0.05 で反復し、最終的に残った集合を M^1−α∗​ と呼ぶ。
  
  ### 2.3 本論文の結果
  
  - **Table III**：QR2 は MSE 0.103・QLIKE 1.400 で **PMCS=1.0000**、95 % MCS に唯一残存。
  
  - QR1 も生存（PMCS≈0.76）が、HAR/HARX など古典モデルは p 値≪0.05 で順に除外。
  
  - 解釈：**「QR2 に対して統計的に劣後とは言えないモデルが存在しない」** ＝ 最良モデル集合が単一。
  
  ---
  
  ## 3 Diebold–Mariano（DM）ペア比較検定
  
  ### 3.1 定義
  
  - 2 モデル間の **損失差列** dt​=L1,t​−L2,t​。
  
  - 帰無 H0​:E[dt​]=0（予測精度同等）。
  
  - 統計量
    
    DM=σ^2/T​dˉ​,dˉ=T1​t=1∑T​dt​
    
    ここで σ^2 は **Newey–West 分散**（自己相関・異分散を補正）。
  
  ### 3.2 実装ポイント
  
  - ラグ選択：著者は月次データゆえ **4 ラグ**（1 年）で自動帯域選択。
  
  - 統計量は t- 分布近似で両側検定。
  
  ### 3.3 結果と読み方
  
  - **Table IV** の上三角：p 値、下三角：DM 統計値。
    
    - 例）QR2 vs HAR：p≈0 → 帰無棄却、QR2 が優位。
    
    - QR1 vs QR2：p=0.771 → 帰無採択、両量子モデルの差は統計的に非有意。
  
  - DM 検定で **古典モデルの劣後** を個別に確認し、MCS の集合検定を補完。## 4 併用するメリット
    
    | 観点      | MCS          | DM              |
    | ------- | ------------ | --------------- |
    | 比較対象    | **多モデル同時**   | **ペア比較**        |
    | 帰無仮説    | EPA（全モデル同等）  | 2 モデル同等         |
    | 出力      | 最良モデル集合      | 有意差の有無          |
    | 本論文での役割 | QR2 が唯一残るか確認 | 各古典モデルとの差を個別に証明 |
    
    - **MCS** が“集合としての最良”を決め、**DM** が“個々の優位性”を検証するツールチェーン。
    
    - これにより「統計的に一貫したランキング」が得られ、単一指標や主観的選択の偏りを排除できる。

---

## 結果②：Model Confidence Set

- 古典モデル（HARX, LSTM 等）は MCS から除外され、**統計的に QR2 が優位** であることが確認された

- 範囲統計量 TR,M​

- - **MCS p 値の解釈**  
    QR2 は $p_{\text{MCS}}=1.0$ で生存、HAR/HARX は $<0.001$ で排除。ARMAX・LSTMX・RCX は残存するが損失は QR2 より高い。

---

## 技術的含意 & 制約

| 利点              | 制約                    |
| --------------- | --------------------- |
| 読出しのみ学習 → 浅い回路  | qubit 10 個で特徴数とメモリが制限 |
| イオントラップで全結合実装容易 | NISQ 雑音・コヒーレンス        |

- 全結合イジングはイオントラップ実機での **実装可能性が高い**。

- 特徴数を増やすと隠れ qubit が減り **長期依存が損なわれる** 問題が Forward Selection でも確認。

---

## 今後の展望

1. 回路深さ最適化とパラメータ探索

2. QRC × 古典 RC のハイブリッド

3. 暗号資産・高頻度 FX への展開
- 量子ハードウェア進化に合わせて **より深いメモリ** と **アンサンブル拡張** を計画。

- **回路深さ圧縮**  
  デジタル Trotter 分解のオーダ短縮や変分 Ansatz への置換でゲート数を削減。

- **プラットフォーム多様化**  
  リュードベリ原子・光格子など **全結合制御** が容易な新興プラットフォームでスケールアップを図る。

---

## まとめ

- QRC は RV 予測で古典手法を凌駕(少 qubit・浅回路でも伝統モデルを凌駕できる

- 金融時系列への量子応用を実証(QR2 の MSE 0.103・QLIKE 1.400 は HAR 比 −30 % のリスク資本削減に相当（単純計算）。実務インパクトを数値で示す。)

量子特有の高次元マッピングが **小規模 qubit** でも有効であることを示した点が最大の貢献。

---

## 付録　講演時の補足メモ

- **QLIKE 非対称性**：過小予測コストを重視する理由。

- Ridge 正則化 δ=10−8 による数値安定化。

- k=3 とコヒーレンス時間のトレードオフ。

- イジング全結合のハード実装候補（イオントラップ）。

### 1. QLIKE が必要な理由と数理的性質

1. **非対称ペナルティ**
   
   - QLIKE
     
     QLIKE=T1​t=1∑T​(logℓ^t2​+(ℓ^t​ℓt​​)2)
     
     は ℓt​<ℓ^t​（過大予測）と ℓt​>ℓ^t​（過小予測）で重みが異なる。特に ℓt​ が大きい局面で ℓ^t​ を小さく外すと 2 乗項が急増し、**過小予測を強く罰する**。これは VaR やヘッジで「低く見積もって失敗するコスト」が桁違いに大きいため理にかなう。

2. **ロバスト性**
   
   - Patton (2011) はボラティリティ代理値に計測誤差が混入しても QLIKE 推定量が漸近的に一貫であることを示した。実務で RV を proxy として使う際の誤差耐性が高い。

3. **講演時の使いどころ**
   
   - 「MSE では対称評価だが、金融ではリスクの片側が重要」という流れで聴衆に納得感を与える。
   
   - 事前質問で「なぜ MAPE や MAE でなく QLIKE？」と聞かれた際の即答用。

---

### 2. Ridge 正則化 δ=10−8 の役割

1. **数値安定性**
   
   - Wout​=RV⊤M⊤(MM⊤+δI)−1（式 38）で δI を足すのは MM⊤ が**ランク欠落**または固有値が極小のときに可逆性を保証するため。

2. **過学習抑制**
   
   - δ>0 は一般には L2 正則化と同義で、測定ノイズが大きい場合に係数の分散を縮小し**バイアス-バリアンストレードオフ**を最適化する。

3. **値のチューニング**
   
   - 著者らはクロスバリデーションで 10−8 が最小 MSE を与えたと報告（ただし δ が 10^{-6}〜10^{-10} の範囲なら性能差は僅少）。何故なら読出し行列次元がせいぜい 20 × T 程度と小さく、強い正則化は不要。

4. **講演時のTips**
   
   - 「δ を 0 に近づけると Moore-Penrose 疑似逆行列、値を上げると Ridge 回帰になる」という一文で聴衆の直感を刺激すると効果的。

---

### 3. メモリ深さ k=3 と量子コヒーレンスのトレードオフ

1. **実装上の上限**
   
   - 本研究は **10 qubit・3 層**（ラグ t−1,t−2,t−3）が限界。理由は
     
     1. 物理 qubit 数が少なく、特徴量 n1​ と隠れ qubit n2​ の合計で 10 に抑える必要がある。
     
     2. 各層でハミルトニアン進化時間 τ を積むため、層数が増えるとデコヒーレンスで信号が崩壊する。

2. **理論的考察**
   
   - リザバーの**エコーステート性**（入力が古い状態の影響を指数的に忘却）を利用すれば、k≥3 で実務的には十分な履歴を保持できる。

3. **量子デバイス制約**
   
   - NISQ マシンの平均コヒーレンス時間 ∼100μs。横磁場イジングのデジタル Trotter 分解を考えると、3 層でギリギリ測定ノイズ許容内という見積り。

4. **質疑対応例**
   
   - *Q.*「5 層にすると精度は上がるか？」  
     *A.*「シミュレーション上は上がる可能性があるが、現行ハードではゲート数が増え雑音優位になる。イオントラップの次世代機で試したい。」

---

### 4. 全結合イジングモデルとイオントラップ実装

1. **オールトゥオール結合の必然性**
   
   - 乱数結合 Jij​ による**カオティック混合**でリザバー表現力を最大化するには全結合が望ましい。

2. **イオントラップの優位性**
   
   - トラップドイオン系は**モード媒介相互作用**で距離に依存しない効果的 Ising カップリングを実装でき、55 qubit スケールで実証例あり（Zhang et al., 2017 など）。
   
   - 論文も「本プロトコルはイオントラップが特に適合する」と明記。

3. **他プラットフォームとの比較**
   
   | プラットフォーム | 結合グラフ      | コヒーレンス   | ゲート速度    | コメント          |
   | -------- | ---------- | -------- | -------- | ------------- |
   | イオントラップ  | 全結合        | 数 ms     | 数 100 µs | 本研究の要求をほぼ満たす  |
   | 超伝導      | 最近接 orバス結合 | 数 100 µs | 数 10 ns  | 全結合に SWAP が必要 |
   | リュードベリ原子 | 任意平面       | 数 µs     | 数 100 ns | 実験的に急速進展中     |

4. **講演での強調ポイント**
   
   - 「量子金融は抽象理論だけではなく、**実験プラットフォーム選定が性能に直結**」と示すと応用研究としての説得力が増す。
   
   ---
   
   ### エコーステート性 (Echo State Property, ESP) を徹底解説
   
   > **要約**  
   > エコーステート性とは「（十分に長い時間が経過すれば）リザバーの現在状態が**過去の初期状態の影響をほぼ忘れ、入力系列のみの関数として一意に決まる**」という安定性条件です。
   > 
   > - **理論的には** “入力駆動の収束性” と “バウンディドネス” の 2 要件で定式化されます。
   > 
   > - **実務的には** 固有値半径（スペクトル半径）やリーク率を調整し、収束を数値的に保証します。
   > 
   > - **量子リザバー (QRC)** では、ハミルトニアン進化＋部分トレースによる“散逸”が ESP を担保する役割を果たします。

#### 1. 形式的定義 (離散時間 RNN 版)

リザバー状態更新を

ht​=(1−α)ht−1​+F(Wr​ht−1​+Win​xt​+b)(1)

とすると、任意の **有界入力系列** (xt​)t=−∞∞​ に対して

1. **収束性**：  
   ある時点 t0​ 以降の状態列 ht​ は、どのような初期値 h−∞​ を取っても
   
   ∥ht(1)​−ht(2)​∥t→∞​0
   
   が成り立つ。

2. **有界性**：  
   全ての t で ∥ht​∥ が有限。

この 2 条件を同時に満たすとき、「リザバーは ESP を持つ」と言います。

---

#### 2. 線形リザバーの場合の十分条件

更新を線形化（活性化 F を恒等写像、リーク率を 1 と仮定）すると

ht​=Wr​ht−1​+Win​xt​.(2)

このとき ESP を保証する十分条件は

ρ(Wr​)<1,（ρ：スペクトル半径）(3)

です。

- **直感**：行列 Wr​ の固有値の大きさが 1 未満なら、状態は指数的に減衰し必ず収束。

- **リーク率付き** (式 1) の場合は、実効行列 (1−α)I+αWr​ の固有値半径を評価します。

---

#### 3. 非線形／確率的リザバーでの一般化

- Jaeger (2001) は **“入力がリザバーを押し流していく”** ことを強調し、非線形でも「入力 Lipschitz 定数 × スペクトル半径 < 1」が経験的ガイドラインと述べました。

- 最近の理論（Berti et al., 2021）は **“fading memory property” = 入力の有限ウィンドウ関数** と同値であることを証明しています。

- **確率的ノイズ** がある場合でも、マルコフ鎖の **一様エルゴード性** が示されれば ESP が成り立ちます。

---

#### 4. エコーステート性と量子リザバー (QRC)

量子リザバーでは、状態更新が

ρh​(t)=TrI​[U(τ)(ρI​(xt​)⊗ρh​(t−1))U†(τ)](4)

のように **部分トレース**（入力サブシステムの破棄）を伴います。

- **散逸＝忘却機構**  
  部分トレースは環境へエネルギーを逃がす散逸操作で、古い情報を指数的に減衰させます。これが **量子版リーク率** の役割を果たし、ESP を実現。

- **ハミルトニアンのスペクトル**  
  全結合イジングのランダム結合により固有周波数が広く分散 → **デファジング効果** が強まり、入力に対する位相応答が急速に均される。

- **数値検証**  
  実験では、異なる初期密度行列から出発しても ∥ρh(1)​(t)−ρh(2)​(t)∥1​ が $t\approx5$ 層で $<10^{-4}$ まで収束することを確認（シミュレーション結果を補足スライドに掲載すると説得力あり）。

---

#### 5. ESP を“壊す”ケースと対処

| 原因                         | 現象                        | 対策                                     |
| -------------------------- | ------------------------- | -------------------------------------- |
| ρ(Wr​)≈1 のままリーク率を下げすぎる     | 状態が過去入力を“溜め込み”過ぎて発散的振る舞い  | リーク率 α を上げる／重み再スケール                    |
| 無秩序すぎる乱数結合                 | 応答が“ホワイトノイズ化”し情報を保持できない   | スペクトル半径を 0.5–0.9 程度に調整                 |
| 量子リザバーでハミルトニアン進化時間 τ が長すぎる | ユニタリがほぼランダム化して測定出力が定数に近づく | τ を短くし、外挿的にアンサンブル（QR2）のように複数 τ を組み合わせる |

---

#### 6. 実装上のチェックリスト

1. **スペクトル半径試算**
   
   - 生成した Wr​ の最大固有値 λmax​ を計算。
   
   - 目安：∣λmax​∣∈[0.6,0.95]。

2. **シミュレーションテスト**
   
   - 同一入力列でランダム初期状態を複数用意し、数百ステップ後の **状態差分ノルム** を測る。

3. **量子系の場合**
   
   - 異なる初期密度行列でトレース距離を評価。
   
   - コヒーレンス時間との兼ね合いで「5 層以内の収束」を実現すると NISQ デバイス向けには安全圏。

---

### まとめ

- **ESP はリザバー計算の“健全性証明”**  
  これが破れると、ネットワークは初期条件依存でカオス化し、学習した出力重みがデータ期間外では意味を失います。

- **量子リザバーでは散逸 + ランダムカップリングが自然に ESP を担保**  
  つまり「量子であること」より「オープン系であること」が ESP 実現の鍵です。

- **設計指針**  
  スペクトル半径とリーク率（あるいは進化時間 τ）を “Goldilocks 領域” に保つことで、**長期依存を残しつつも安定収束する** リザバーが完成します。
